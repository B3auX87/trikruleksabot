command(client, ['clear'], (message) => {
  if (!message.member.hasPermission('MANAGE_MESSAGES')) {
    // Your return statement and error message should be within the same if statement scope (the curly braces)
    message.channel.send(
      'Error. You do not have permission to delete messages.'
    )
    return
  }

  message.channel.messages.fetch().then((results) => {
    let counter = 0

    // results is a collection of messages so we can use.forEach to loop through them
    results.forEach((message) => {
      if (counter++ < 10) {
        // Manually delete each one with .delete()
        console.log(`Deleting message "${message.content}"`)
        message.delete()
      }
    })
  })
})

const mongo = require('./mongo')
const commandPrefixSchema = require('./schemas/command-prefix-schema')
const commandBase = require('./commands/command-base')

module.exports = {
  commands: 'setprefix',
  minArgs: 1,
  maxArgs: 1,
  expectedArgs: "<neuer Prefix>",
  permissions: 'ADMINISTRATOR',
  callback: async (message, arguments, text) => {
    await mongo().then(async (mongoose) => {
      try {
        const guildId = message.guild.id
        const prefix = arguments[0]

        mongoose.set('useFindAndModify', false)
        await commandPrefixSchema.findOneAndUpdate(
          {
            _id: guildId,
          },
          {
            _id: guildId,
            prefix,
          },
          {
            upsert: true,
          }
        )

        message.reply(`Der neue Prefix f√ºr Leksa auf diesem Server ist jetzt ${prefix}`)

        commandBase.updateCache(guildId, prefix)
      } finally {

        mongoose.connection.close()
      }
    })
  },
}

